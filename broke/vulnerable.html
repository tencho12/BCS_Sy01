<!DOCTYPE html>
<html>
  <head>
    <title>Vulnerable Page</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <h2>Vulnerable Login Form</h2>
    <p>This login form has multiple vulnerabilities:</p>
    <ul>
      <li>No protection against brute force attacks.</li>
      <li>No account lockout mechanism.</li>
      <li>No CAPTCHA.</li>
      <li>Weak password policy (accepts any password).</li>
    </ul>

    <form id="vulnerableLoginForm" action="p1.php" method="post">
      <input type="hidden" name="vulnerability" value="vulnerable_login" />
      <input
        type="text"
        name="username"
        placeholder="Username"
        required
      /><br />
      <input
        type="password"
        name="password"
        placeholder="Password"
        required
      /><br />
      <button type="submit">Login</button>
    </form>
    <div id="vulnerableLoginResult"></div>

    <h2>Vulnerable Code</h2>
    <pre id="vulnerableCode">
    // Vulnerable login logic (no brute force protection, no account lockout, no CAPTCHA)
    if ($username === 'admin' && $password === 'password123') { 
      // Login successful!
    } else {
      // Invalid username or password.
    }
  </pre
    >

    <h2>Quiz</h2>
    <p>Answer the following questions about brute force attacks:</p>
    <form id="quizForm">
      <div id="question1" class="question">
        <p>1. What is a brute force attack?</p>
        <label
          ><input type="radio" name="q1" value="a" /> a) Guessing passwords by
          trying all possible combinations.</label
        ><br />
        <label
          ><input type="radio" name="q1" value="b" /> b) Injecting malicious
          code into a website.</label
        ><br />
        <label
          ><input type="radio" name="q1" value="c" /> c) Stealing user data from
          a database.</label
        ><br />
        <button type="button" onclick="checkAnswer(1)">Check Answer</button>
      </div>
      <div id="question2" class="question" style="display: none">
        <p>
          2. How can you mitigate brute force attacks? (Select all that apply)
        </p>
        <label
          ><input type="checkbox" name="q2[]" value="a" /> a) Account
          lockout</label
        ><br />
        <label
          ><input type="checkbox" name="q2[]" value="b" /> b) Rate
          limiting</label
        ><br />
        <label><input type="checkbox" name="q2[]" value="c" /> c) CAPTCHA</label
        ><br />
        <label
          ><input type="checkbox" name="q2[]" value="d" /> d) Strong password
          policy</label
        ><br />
        <button type="button" onclick="checkAnswer(2)">Check Answer</button>
      </div>
      <div id="question3" class="question" style="display: none">
        <p>
          3. What is the purpose of account lockout in mitigating brute force
          attacks?
        </p>
        <label
          ><input type="radio" name="q3" value="a" /> a) To prevent users from
          logging in with incorrect passwords multiple times.</label
        ><br />
        <label
          ><input type="radio" name="q3" value="b" /> b) To slow down the
          attacker by introducing delays between login attempts.</label
        ><br />
        <label
          ><input type="radio" name="q3" value="c" /> c) To make it more
          difficult for attackers to guess passwords by requiring complex
          combinations.</label
        ><br />
        <button type="button" onclick="checkAnswer(3)">Check Answer</button>
      </div>
      <div id="question4" class="question" style="display: none">
        <p>
          4. What is a CAPTCHA and how does it help prevent brute force attacks?
        </p>
        <label
          ><input type="radio" name="q4" value="a" /> a) A type of encryption
          that makes passwords harder to crack.</label
        ><br />
        <label
          ><input type="radio" name="q4" value="b" /> b) A test to distinguish
          between humans and automated bots, preventing automated brute force
          attempts.</label
        ><br />
        <label
          ><input type="radio" name="q4" value="c" /> c) A security measure that
          logs users out after a certain period of inactivity.</label
        ><br />
        <button type="button" onclick="checkAnswer(4)">Check Answer</button>
      </div>
      <div id="question5" class="question" style="display: none">
        <p>
          5. Why is a strong password policy important in preventing brute force
          attacks?
        </p>
        <label
          ><input type="radio" name="q5" value="a" /> a) It ensures that users
          choose passwords that are easy to remember.</label
        ><br />
        <label
          ><input type="radio" name="q5" value="b" /> b) It makes it
          computationally more expensive for attackers to guess passwords, as
          the number of possible combinations increases.</label
        ><br />
        <label
          ><input type="radio" name="q5" value="c" /> c) It prevents users from
          reusing the same password for multiple accounts.</label
        ><br />
        <button type="button" onclick="checkAnswer(5)">Check Answer</button>
      </div>
    </form>
    <div id="quizResult"></div>

    <script>
      document
        .getElementById("vulnerableLoginForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();
          const form = e.target;
          fetch(form.action, {
            method: form.method,
            body: new FormData(form),
          })
            .then((response) => response.text())
            .then((data) => {
              const response = JSON.parse(data);
              document.getElementById("vulnerableLoginResult").textContent =
                response.message;
            })
            .catch((error) => {
              console.error("Error:", error);
              document.getElementById("vulnerableLoginResult").textContent =
                "An error occurred.";
            });
        });

      let currentQuestion = 1;
      let codeSnippet = document.getElementById("vulnerableCode").textContent;
      function checkAnswer(questionNumber) {
        if (questionNumber === 1) {
          if (
            document.querySelector('input[name="q1"]:checked').value === "a"
          ) {
            document.getElementById("quizResult").textContent = "Correct!";
            document.getElementById("question1").style.display = "none";
            document.getElementById("question2").style.display = "block";
            currentQuestion = 2;
          } else {
            document.getElementById("quizResult").textContent =
              "Incorrect. Please try again.";
          }
        } else if (questionNumber === 2) {
          const checkboxes = document.querySelectorAll(
            'input[name="q2[]"]:checked'
          );
          const selectedAnswers = Array.from(checkboxes).map((cb) => cb.value);
          if (
            selectedAnswers.length === 4 &&
            selectedAnswers.includes("a") &&
            selectedAnswers.includes("b") &&
            selectedAnswers.includes("c") &&
            selectedAnswers.includes("d")
          ) {
            document.getElementById("quizResult").textContent = "Correct!";

            // Update the code snippet
            codeSnippet = `// Improved code with brute force mitigation
if (isAccountLocked($username)) {
  // Account locked
} else {
  $loginAttempts = getFailedLoginAttempts($username);
  if ($loginAttempts >= 5) {
    // Lock account
  } else {
    if (verifyCaptcha()) { 
      if (isValidPassword($password) && $username === 'admin' && $password === 'password123') {
        // Login successful!
      } else {
        // Invalid username or password.
        incrementFailedLoginAttempts($username);
      }
    } else {
      // CAPTCHA failed
    }
  }
}`;
            document.getElementById("vulnerableCode").textContent = codeSnippet;
            document.getElementById("question2").style.display = "none";
            document.getElementById("question3").style.display = "block";
            currentQuestion = 3;
          } else {
            document.getElementById("quizResult").textContent =
              "Incorrect. Please select all the correct options.";
          }
        } else if (questionNumber === 3) {
          if (
            document.querySelector('input[name="q3"]:checked').value === "a"
          ) {
            document.getElementById("quizResult").textContent = "Correct!";
            document.getElementById("question3").style.display = "none";
            document.getElementById("question4").style.display = "block";
            currentQuestion = 4;
          } else {
            document.getElementById("quizResult").textContent =
              "Incorrect. Please try again.";
          }
        } else if (questionNumber === 4) {
          if (
            document.querySelector('input[name="q4"]:checked').value === "b"
          ) {
            document.getElementById("quizResult").textContent = "Correct!";
            document.getElementById("question4").style.display = "none";
            document.getElementById("question5").style.display = "block";
            currentQuestion = 5;
          } else {
            document.getElementById("quizResult").textContent =
              "Incorrect. Please try again.";
          }
        } else if (questionNumber === 5) {
          if (
            document.querySelector('input[name="q5"]:checked').value === "b"
          ) {
            document.getElementById("quizResult").textContent = "Correct!";
            document.getElementById("question5").style.display = "none";
            // No more questions
          } else {
            document.getElementById("quizResult").textContent =
              "Incorrect. Please try again.";
          }
        }
      }
    </script>
  </body>
</html>
